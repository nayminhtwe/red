<template>
  <section class="ptb-70">
    <div class="container">
      <div class="row">
        <div class="col-xl-2 col-lg-3 mb-sm-30 col-lgmd-20per">
          <div class="sidebar-block">
            <div class="sidebar-box mb-40">
              <span class="opener plus" />
              <div class="sidebar-title">
                <h3><span>Shop by</span></h3>
              </div>
              <!-- <div class="sidebar-contant">
                <div class="price-range mb-30">
                  <div class="inner-title">
                    Price range
                  </div>
                  <input class="price-txt" type="text" id="amount">
                  <div id="slider-range" />
                </div>
                <div class="size mb-20">
                  <div class="inner-title">
                    Size
                  </div>
                  <ul>
                    <li><a href="#">S (10)</a></li>
                    <li><a href="#">M (05)</a></li>
                    <li><a href="#">L (10)</a></li>
                    <li><a href="#">XL (08)</a></li>
                    <li><a href="#">XXL (05)</a></li>
                  </ul>
                </div>
                <div class="mb-20">
                  <div class="inner-title">
                    Color
                  </div>
                  <ul>
                    <li><a href="#">Black <span>(0)</span></a></li>
                    <li><a href="#">Blue <span>(05)</span></a></li>
                    <li><a href="#">Brown <span>(10)</span></a></li>
                  </ul>
                </div>
                <div class="mb-20">
                  <div class="inner-title">
                    Manufacture
                  </div>
                  <ul>
                    <li><a href="#">Augue congue <span>(0)</span></a></li>
                    <li><a href="#">Eu magna <span>(05)</span></a></li>
                    <li><a href="#">Ipsum sit <span>(10)</span></a></li>
                  </ul>
                </div>
                <a href="#" class="btn btn-color">Refine</a>
              </div> -->
            </div>
            <div class="sidebar-box mb-40 d-none d-lg-block">
              <a href="#">
                <img src="/assets/images/left-banner.jpg" alt="Stylexpo">
              </a>
            </div>
            <div class="sidebar-box sidebar-item">
              <span class="opener plus" />
              <div class="sidebar-title">
                <h3><span>Best Selle</span>r</h3>
              </div>
              <div class="sidebar-contant">
                <ul>
                  <li>
                    <div class="pro-media">
                      <a href="#"><img alt="T-shirt" src="/assets/images/1.jpg"></a>
                    </div>
                    <div class="pro-detail-info">
                      <a href="#">Black African Print</a>
                      <div class="rating-summary-block">
                        <div class="rating-result" title="53%">
                          <span style="width:53%" />
                        </div>
                      </div>
                      <div class="price-box">
                        <span class="price">$80.00</span>
                      </div>
                      <div class="cart-link">
                        <form>
                          <button title="Add to Cart">
                            Add To Cart
                          </button>
                        </form>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="pro-media">
                      <a href="#"><img alt="T-shirt" src="/assets/images/1.jpg"></a>
                    </div>
                    <div class="pro-detail-info">
                      <a href="#">Black African Print</a>
                      <div class="rating-summary-block">
                        <div class="rating-result" title="53%">
                          <span style="width:53%" />
                        </div>
                      </div>
                      <div class="price-box">
                        <span class="price">$80.00</span>
                      </div>
                      <div class="cart-link">
                        <form>
                          <button title="Add to Cart">
                            Add To Cart
                          </button>
                        </form>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="pro-media">
                      <a href="#"><img alt="T-shirt" src="/assets/images/1.jpg"></a>
                    </div>
                    <div class="pro-detail-info">
                      <a href="#">Black African Print</a>
                      <div class="rating-summary-block">
                        <div class="rating-result" title="53%">
                          <span style="width:53%" />
                        </div>
                      </div>
                      <div class="price-box">
                        <span class="price">$80.00</span>
                      </div>
                      <div class="cart-link">
                        <form>
                          <button title="Add to Cart">
                            Add To Cart
                          </button>
                        </form>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-10 col-lg-9 col-lgmd-80per">
          <div class="shorting mb-30">
            <div class="row">
              <div class="col-lg-6">
                <!-- <div class="view">
                  <div class="list-types grid active ">
                    <a href="shop.html">
                      <div class="grid-icon list-types-icon" />
                    </a>
                  </div>
                  <div class="list-types list">
                    <a href="shop-list.html">
                      <div class="list-icon list-types-icon" />
                    </a>
                  </div>
                </div> -->
                <!-- <div class="short-by float-right-sm">
                  <span>Sort By :</span>
                  <div class="select-item select-dropdown">
                    <fieldset>
                      <select name="speed" id="sort-price" class="option-drop">
                        <option value="" selected="selected">
                          Name (A to Z)
                        </option>
                        <option value="">
                          Name(Z - A)
                        </option>
                        <option value="">
                          price(low&gt;high)
                        </option>
                        <option value="">
                          price(high &gt; low)
                        </option>
                        <option value="">
                          rating(highest)
                        </option>
                        <option value="">
                          rating(lowest)
                        </option>
                      </select>
                    </fieldset>
                  </div>
                </div> -->
              </div>
              <div class="col-lg-6">
                <!-- <div class="show-item right-side float-left-sm">
                  <span>Show :</span>
                  <div class="select-item select-dropdown">
                    <fieldset>
                      <select name="speed" id="show-item" class="option-drop">
                        <option value="" selected="selected">
                          24
                        </option>
                        <option value="">
                          12
                        </option>
                        <option value="">
                          6
                        </option>
                      </select>
                    </fieldset>
                  </div>
                  <span>Per Page</span>
                  <div class="compare float-right-sm">
                    <a href="#" class="btn btn-color">Compare (0)</a>
                  </div>
                </div> -->
              </div>
            </div>
          </div>
          <product-listing component="search-products" :products="visibleProducts" :name="search" />
        </div>
      </div>
    </div>
  </section>
</template>

<script>
import SearchPanel from '@vue-storefront/core/compatibility/components/blocks/SearchPanel/SearchPanel'
// Theme core components
import ProductListing from 'theme/components/core/ProductListing'
import ProductTile from 'theme/components/core/ProductTile'
import VueOfflineMixin from 'vue-offline/mixin'
import CategoryPanel from 'theme/components/core/blocks/Category/CategoryPanel'
import { minLength } from 'vuelidate/lib/validators'
import { disableBodyScroll, clearAllBodyScrollLocks } from 'body-scroll-lock'

export default {
  name: 'Search',
  components: {
    ProductTile,
    CategoryPanel,
    ProductListing
  },
  mixins: [SearchPanel, VueOfflineMixin],
  validations: {
    search: {
      minLength: minLength(3)
    }
  },
  data () {
    return {
      selectedCategoryIds: []
    }
  },
  computed: {
    visibleProducts () {
      const productList = this.products || []
      if (this.selectedCategoryIds.length) {
        return productList.filter(product => product.category_ids.some(categoryId => {
          return this.selectedCategoryIds.includes(categoryId)
        }))
      }
      return productList
    },
    categories () {
      const categories = this.products
        .filter(p => p.category)
        .map(p => p.category)
        .flat()

      const distinctCategories = Array.from(
        new Set(categories.map(c => c.category_id))
      ).map(catId => categories.find(c => c.category_id === catId))

      return distinctCategories
    },
    getNoResultsMessage () {
      let msg = ''
      if (!this.$v.search.minLength) {
        msg = 'Searched term should consist of at least 3 characters.'
      } else if (this.emptyResults) {
        msg = 'No results were found.'
      }
      return msg
    }
  },
  watch: {
    categories () {
      this.selectedCategoryIds = []
    }
  },
  async created () {
    if (this.$route.params.keyword) {
      await localStorage.setItem(`shop/user/searchQuery`, this.$route.params.keyword);
    }
  },
  async beforeRouteUpdate (to, from, next) {
    this.search = to.params.keyword;
    await this.makeSearch();
    next();
  }
}
</script>

<style scoped>

</style>
