<template>
  <div id="categories_popup" class="white-popup-block popup-position">
    <div class="popup-title">
      <h2 class="main_title heading">
        <span>categories</span>
      </h2>
    </div>
    <div class="popup-detail">
      <ul class="cate-inner">
        <li class="level sub-megamenu">
          <span class="opener plus" />
          <a href="shop.html" class="page-scroll"><i class="fa fa-female" />Fashion (10)</a>
          <div class="megamenu  mega-sub-menu">
            <div class="megamenu-inner-top">
              <ul class="sub-menu-level1">
                <li class="level2">
                  <ul class="sub-menu-level2 ">
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Blazer &amp; Coat</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Sport Shoes</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Trousers</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Purse</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Wallets</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Skirts</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Tops</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Sleepwear</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Jeans</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </li>
        <li class="level">
          <a href="shop.html" class="page-scroll"><i class="fa fa-camera-retro" />Cameras (70)</a>
        </li>
        <li class="level">
          <a href="shop.html" class="page-scroll"><i class="fa fa-desktop" />computers (10)</a>
        </li>
        <li class="level sub-megamenu">
          <span class="opener plus" />
          <a href="shop.html" class="page-scroll"><i class="fa fa-clock-o" />Wathches (15)</a>
          <div class="megamenu mega-sub-menu">
            <div class="megamenu-inner-top">
              <ul class="sub-menu-level1">
                <li class="level2">
                  <ul class="sub-menu-level2">
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Dresses</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Sport Jeans</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Skirts</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Tops</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Sleepwear</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Jeans</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Blazer &amp; Coat</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Sport Shoes</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Phone Cases</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Trousers</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Purse</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Wallets</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </li>
        <li class="level">
          <a href="shop.html" class="page-scroll"><i class="fa fa-shopping-bag" />Bags (18)</a>
        </li>
        <li class="level sub-megamenu ">
          <span class="opener plus" />
          <a href="shop.html" class="page-scroll"><i class="fa fa-tablet" />Smartphones (20)</a>
          <div class="megamenu mega-sub-menu">
            <div class="megamenu-inner-top">
              <ul class="sub-menu-level1">
                <li class="level2">
                  <ul class="sub-menu-level2">
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Dresses</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Sport Jeans</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Skirts</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Tops</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Sleepwear</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Jeans</a>
                    </li>
                  </ul>
                </li>
                <li class="level2">
                  <ul class="sub-menu-level2 ">
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Blazer &amp; Coat</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Sport Shoes</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Phone Cases</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Trousers</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Purse</a>
                    </li>
                    <li class="level3">
                      <a href="shop.html"><span>■</span>Wallets</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </li>
        <li class="level">
          <a href="shop.html" class="page-scroll"><i class="fa fa-heart" />Software</a>
        </li>
        <li class="level ">
          <a href="shop.html" class="page-scroll"><i class="fa fa-headphones" />Headphone (12)</a>
        </li>
        <li class="level">
          <a href="shop.html" class="page-scroll"><i class="fa fa-microphone" />Accessories (70)</a>
        </li>
        <li class="level">
          <a href="shop.html" class="page-scroll"><i class="fa fa-bolt" />Printers &amp; Ink</a>
        </li>
        <li class="level">
          <a href="shop.html" class="page-scroll"><i class="fa fa-plus-square" />More Categories</a>
        </li>
      </ul>
    </div>
    <button title="Close (Esc)" type="button" class="mfp-close" @click="closeMenu">
      ×
    </button>
  </div>
</template>

<script>
import { mapState } from 'vuex'
import i18n from '@vue-storefront/i18n'
import SidebarMenu from '@vue-storefront/core/compatibility/components/blocks/SidebarMenu/SidebarMenu'
import SubBtn from 'theme/components/core/blocks/SidebarMenu/SubBtn'
import SubCategory from 'theme/components/core/blocks/SidebarMenu/SubCategory'
import { formatCategoryLink } from '@vue-storefront/core/modules/url/helpers'
import { disableBodyScroll, clearAllBodyScrollLocks } from 'body-scroll-lock'

export default {
  components: {
    SubCategory,
    SubBtn
  },
  mixins: [SidebarMenu],
  data () {
    return {
      myAccountLinks: [
        {
          id: 1,
          name: i18n.t('My profile'),
          url: '/my-account'
        },
        {
          id: 2,
          name: i18n.t('My shipping details'),
          url: '/my-account/shipping-details'
        },
        {
          id: 3,
          name: i18n.t('My newsletter'),
          url: '/my-account/newsletter'
        },
        {
          id: 4,
          name: i18n.t('My orders'),
          url: '/my-account/orders'
        },
        {
          id: 5,
          name: i18n.t('My loyalty card'),
          url: '#'
        },
        {
          id: 6,
          name: i18n.t('My product reviews'),
          url: '#'
        }
      ],
      componentLoaded: false
    }
  },
  computed: {
    mainListStyles () {
      return this.submenu.depth ? `transform: translateX(${this.submenu.depth * 100}%)` : false
    },
    ...mapState({
      submenu: state => state.ui.submenu,
      currentUser: state => state.user.current
    }),
    getSubmenu () {
      return this.submenu
    },
    visibleCategories () {
      return this.categories.filter(category => {
        return category.product_count > 0 || category.children_count > 0
      })
    },
    isCurrentMenuShowed () {
      return !this.getSubmenu || !this.getSubmenu.depth
    }
  },
  mounted () {
    this.$nextTick(() => {
      this.componentLoaded = true;
      // disableBodyScroll(this.$refs.container)
    })
  },
  destroyed () {
    // clearAllBodyScrollLocks()
  },
  methods: {
    login () {
      if (!this.currentUser && this.isCurrentMenuShowed) {
        this.$nextTick(() => {
          this.$store.commit('ui/setAuthElem', 'login')
          this.$bus.$emit('modal-show', 'modal-signup')
          this.$router.push({ name: 'my-account' })
        })
      }
    },
    categoryLink (category) {
      return formatCategoryLink(category)
    }
  }
}
</script>
